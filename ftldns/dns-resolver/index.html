



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://docs.pi-hole.net/ftldns/dns-resolver/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.2">
    
    
      
        <title>DNS resolver - Pi-hole documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.3020aac5.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#implemented-modifications-in-dnsmasqs-source-code" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://docs.pi-hole.net" title="Pi-hole documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Pi-hole documentation
            </span>
            <span class="md-header-nav__topic">
              DNS resolver
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/pi-hole/pi-hole/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://docs.pi-hole.net" title="Pi-hole documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Pi-hole documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/pi-hole/pi-hole/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      About Pi-hole
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        About Pi-hole
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../main/contact/" title="Contact Us" class="md-nav__link">
      Contact Us
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../main/origins/" title="Pi-hole Origins" class="md-nav__link">
      Pi-hole Origins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../main/presentations/" title="Presentation Support" class="md-nav__link">
      Presentation Support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../main/coverage/" title="On the Web" class="md-nav__link">
      On the Web
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../main/prerequesites/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../main/basic-install/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../main/post-install/" title="Post-Install" class="md-nav__link">
      Post-Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../main/update/" title="Updating" class="md-nav__link">
      Updating
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Pi-hole Core
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Pi-hole Core
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/pihole-command/" title="The pihole command" class="md-nav__link">
      The <samp>pihole</samp> command
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      FTLDNS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        FTLDNS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../configfile/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        DNS resolver
      </label>
    
    <a href="./" title="DNS resolver" class="md-nav__link md-nav__link--active">
      DNS resolver
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#implemented-modifications-in-dnsmasqs-source-code" title="Implemented modifications in dnsmasq's source code" class="md-nav__link">
    Implemented modifications in dnsmasq's source code
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ftl-hooks" title="FTL hooks" class="md-nav__link">
    FTL hooks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-limit-on-maximum-cache-size" title="Remove limit on maximum cache size" class="md-nav__link">
    Remove limit on maximum cache size
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improve-detection-algorithm-for-determining-the-best-forward-destination" title="Improve detection algorithm for determining the "best" forward destination" class="md-nav__link">
    Improve detection algorithm for determining the "best" forward destination
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dns-cache/" title="DNS cache" class="md-nav__link">
      DNS cache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../blockingmode/" title="Blocking mode" class="md-nav__link">
      Blocking mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-6" type="checkbox" id="nav-5-6">
    
    <label class="md-nav__link" for="nav-5-6">
      RegEx blocking
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-6">
        RegEx blocking
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../regex/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../regex/tutorial/" title="Tutorial" class="md-nav__link">
      Tutorial
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../privacylevels/" title="Privacy levels" class="md-nav__link">
      Privacy levels
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../database/" title="Long-term database" class="md-nav__link">
      Long-term database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../telnet-api/" title="Telnet API" class="md-nav__link">
      Telnet API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../compatibility/" title="Compatibility" class="md-nav__link">
      Compatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../compile/" title="Install from source" class="md-nav__link">
      Install from source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../debugging/" title="Debugging FTLDNS" class="md-nav__link">
      Debugging FTLDNS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../in-depth/" title="In-depth manual" class="md-nav__link">
      In-depth manual
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Docker
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Docker
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../docker/DHCP/" title="DHCP" class="md-nav__link">
      DHCP
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Contributing
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Contributing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/github/contributing/" title="Contributing on Github" class="md-nav__link">
      Contributing on Github
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/github/how-to-signoff/" title="How to sign-off commits" class="md-nav__link">
      How to sign-off commits
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/unbound/" title="Pi-hole as All-Around DNS Solution" class="md-nav__link">
      Pi-hole as All-Around DNS Solution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/dns-over-https/" title="Configuring DNS-Over-HTTPS on Pi-hole" class="md-nav__link">
      Configuring DNS-Over-HTTPS on Pi-hole
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/upstream-dns-providers/" title="Upstream DNS Providers" class="md-nav__link">
      Upstream DNS Providers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/whitelist-blacklist/" title="Editing Whitelist and Blacklist" class="md-nav__link">
      Editing Whitelist and Blacklist
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/nginx-configuration/" title="Configuring NGINX for Pi-hole" class="md-nav__link">
      Configuring NGINX for Pi-hole
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/caddy-configuration/" title="Configuring Caddy for Pi-hole" class="md-nav__link">
      Configuring Caddy for Pi-hole
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/traefik-configuration-nodocker/" title="Configuring Traefik for Pi-hole (not in Docker)" class="md-nav__link">
      Configuring Traefik for Pi-hole (not in Docker)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-8" type="checkbox" id="nav-8-8">
    
    <label class="md-nav__link" for="nav-8-8">
      Pi-hole and OpenVPN Server
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-8">
        Pi-hole and OpenVPN Server
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/vpn/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/vpn/installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/vpn/setup-openvpn-server/" title="Setup OpenVPN Server" class="md-nav__link">
      Setup OpenVPN Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/vpn/firewall/" title="Firewall Configuration" class="md-nav__link">
      Firewall Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-8-5" type="checkbox" id="nav-8-8-5">
    
    <label class="md-nav__link" for="nav-8-8-5">
      Connecting clients
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-8-8-5">
        Connecting clients
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/vpn/clients/" title="General" class="md-nav__link">
      General
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/vpn/android-client/" title="Android" class="md-nav__link">
      Android
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/vpn/only-dns-via-vpn/" title="Optional: Only route DNS via VPN" class="md-nav__link">
      Optional: Only route DNS via VPN
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/vpn/dual-operation/" title="Optional: Dual operation: LAN & VPN at the same time" class="md-nav__link">
      Optional: Dual operation: LAN & VPN at the same time
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/vpn/dual-VPN/" title="Optional: Full and DNS-only" class="md-nav__link">
      Optional: Full and DNS-only
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/vpn/dynDNS/" title="Optional: Dynamic DNS" class="md-nav__link">
      Optional: Dynamic DNS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-9" type="checkbox" id="nav-8-9">
    
    <label class="md-nav__link" for="nav-8-9">
      TOR & Pi-hole
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-9">
        TOR & Pi-hole
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/tor/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/tor/setup/" title="Basic Setup" class="md-nav__link">
      Basic Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/tor/using-tor/" title="Using TOR" class="md-nav__link">
      Using TOR
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/tor/performance-issues/" title="Performance and other issues" class="md-nav__link">
      Performance and other issues
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guides/tor/dnssec/" title="Using DNSSEC" class="md-nav__link">
      Using DNSSEC
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../main/projects/" title="Community Projects" class="md-nav__link">
      Community Projects
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#implemented-modifications-in-dnsmasqs-source-code" title="Implemented modifications in dnsmasq's source code" class="md-nav__link">
    Implemented modifications in dnsmasq's source code
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ftl-hooks" title="FTL hooks" class="md-nav__link">
    FTL hooks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-limit-on-maximum-cache-size" title="Remove limit on maximum cache size" class="md-nav__link">
    Remove limit on maximum cache size
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#improve-detection-algorithm-for-determining-the-best-forward-destination" title="Improve detection algorithm for determining the "best" forward destination" class="md-nav__link">
    Improve detection algorithm for determining the "best" forward destination
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>DNS resolver</h1>
                
                <p><em><abbr title="Pi-hole's Faster Than Light daemon">FTL</abbr></em><abbr title="Domain Name Service (decentralized naming system for computers, services, or other resources connected to the Internet)">DNS</abbr> comes with a lightweight but powerful inbuilt <abbr title="Domain Name Service (decentralized naming system for computers, services, or other resources connected to the Internet)">DNS</abbr>/<abbr title="Dynamic Host Configuration Protocol (network management protocol for configuring Internet Protocol version 4 (IPv4) hosts with IP addresses)">DHCP</abbr>/<abbr title="Trivial File Transfer Protocol is a simple lockstep File Transfer Protocol which allows a client to get a file from or put a file onto a remote host">TFTP</abbr>/... server eliminating the need to install <code>dnsmasq</code> separately (we used to do this before Pi-hole v4.0). However, it is important to understand that we are not moving away from <code>dnsmasq</code>, but, in contrast, are coupling even closer to it by incorporating it into <abbr title="Pi-hole's Faster Than Light daemon">FTL</abbr>. This provides us with a much more reliable monolith <abbr title="Domain Name Service (decentralized naming system for computers, services, or other resources connected to the Internet)">DNS</abbr> solution where we can be sure that the versions of <em><abbr title="Pi-hole's Faster Than Light daemon">FTL</abbr></em> and the <abbr title="Domain Name Service (decentralized naming system for computers, services, or other resources connected to the Internet)">DNS</abbr> internals are always 100% compatible with each other.</p>
<p>As we maintain our own fork of <code>dnsmasq</code> we have been able to apply some <em>minimal</em> changes to the source code which might bring substantial benefits for our users. However, although the potential for changes is endless, we want to include as few modifications as possible. As a purely volunteer driven project, you will surely understand that it was already a major undertaking to get <em><abbr title="Pi-hole's Faster Than Light daemon">FTL</abbr></em><abbr title="Domain Name Service (decentralized naming system for computers, services, or other resources connected to the Internet)">DNS</abbr> set up and running. It was much more than just copy-pasting <code>dnsmasq</code> into place.</p>
<p>We have always been very explicit about how we will react to feature requests that target the resolver part (from the initial <em><abbr title="Pi-hole's Faster Than Light daemon">FTL</abbr></em><abbr title="Domain Name Service (decentralized naming system for computers, services, or other resources connected to the Internet)">DNS</abbr> beta test announcement):</p>
<blockquote>
<p>Think of <em><abbr title="Pi-hole's Faster Than Light daemon">FTL</abbr></em><abbr title="Domain Name Service (decentralized naming system for computers, services, or other resources connected to the Internet)">DNS</abbr> as <code>dnsmasq</code> with Pi-hole’s special sauce. This allows us to easily merge any upstream changes that get added, while still allowing us to continue to develop Pi-hole as we have been.</p>
</blockquote>
<p>If we would start to modify the resolver code in too many places, then this would probably make us deviate too much from <code>dnsmasq</code>'s code base and we couldn't apply patches easily preventing us from being able to ship important security updates.</p>
<h3 id="implemented-modifications-in-dnsmasqs-source-code">Implemented modifications in <code>dnsmasq</code>'s source code<a class="headerlink" href="#implemented-modifications-in-dnsmasqs-source-code" title="Permanent link">&para;</a></h3>
<h4 id="ftl-hooks"><abbr title="Pi-hole's Faster Than Light daemon">FTL</abbr> hooks<a class="headerlink" href="#ftl-hooks" title="Permanent link">&para;</a></h4>
<p>We place hooks in a lot of places in the resolver that branch out into <code>FTL</code> code to process queries and responses. By this, we keep the resolver code itself clean.</p>
<h4 id="remove-limit-on-maximum-cache-size">Remove limit on maximum cache size<a class="headerlink" href="#remove-limit-on-maximum-cache-size" title="Permanent link">&para;</a></h4>
<p>Users are able to configure the size of the resolvers name cache. The default is 150 names. Setting the cache size to zero disables caching. We think users should be allowed to set the cache size to any value they find appropriate. However, <code>dnsmasq</code>'s source code contains a condition that limits the maximum size of the cache to 10,000 names. We removed this hard-coded upper limit in <a href="https://github.com/pi-hole/FTL/commit/ea3309e7b1991f50d40555b9a18f39894c237b29#diff-733116077302620357dcd8252f41449dR2582R258">option.c</a> and submitted a patch to remove this hard-coded limit in the upstream version of <code>dnsmasq</code>.</p>
<h4 id="improve-detection-algorithm-for-determining-the-best-forward-destination">Improve detection algorithm for determining the "best" forward destination<a class="headerlink" href="#improve-detection-algorithm-for-determining-the-best-forward-destination" title="Permanent link">&para;</a></h4>
<p>The <abbr title="Domain Name Service (decentralized naming system for computers, services, or other resources connected to the Internet)">DNS</abbr> forward destination determination algorithm in <em><abbr title="Pi-hole's Faster Than Light daemon">FTL</abbr></em><abbr title="Domain Name Service (decentralized naming system for computers, services, or other resources connected to the Internet)">DNS</abbr>'s is modified to be much less restrictive than the original algorithm in <code>dnsmasq</code>. We keep using the fastest responding server now for 1000 queries or 10 minutes (whatever happens earlier) instead of 50 queries or 10 seconds (default values in <code>dnsmasq</code>).
We keep the exceptions, i.e., we try all possible forward destinations if <code>SERVFAIL</code> or <code>REFUSED</code> is received or if a timeout occurs.
Overall, this change has proven to greatly reduce the number of actually performed queries in typical Pi-hole environments. It may even be understood as being preferential in terms of privacy (as we send queries much less often to all servers).
This has been implemented in commit <a href="https://github.com/pi-hole/FTL/commit/d1c163e499a5cd9f311610e9da1e9365bbf81e89">d1c163e</a> on the <code>FTLDNS</code> branch.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../configfile/" title="Configuration" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Configuration
              </span>
            </div>
          </a>
        
        
          <a href="../dns-cache/" title="DNS cache" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                DNS cache
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 Pi-hole LLC
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://pi-hole.net" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/pi-hole" class="md-footer-social__link fa fa-github-alt"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.267712eb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>